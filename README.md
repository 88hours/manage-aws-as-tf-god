
# Create an AWS Delegated Admin Management Account  
```bash
sh root-scripts/create-delegate-management-account.sh
```
# Create an AWS Organization Admin Module **managment-account/create-aws-org-admin.tf**  

Terraform uses the environment variable `AWS_PROFILE` to select which AWS credentials profile to use.
You can also use 
```bash
export PARENT_DIR=$HOME/<main path for parent dir>
```
Other usefull AWS CLI commands 
```bash
aws iam list-attached-user-policies --user-name <user_name>
aws iam list-user-policies --user-name <user_name> --query "PolicyNames" --output text
aws iam get-user-policy --user-name <user_name> --policy-name <policy_name>
```
This repository contains Terraform code to provision an AWS IAM user with administrative permissions for AWS Organizations, along with access keys.

You need to run this from a delegated admin account.

After creation, log in to the Org admin account, enable MFA, and reset the password.

## Security

- The `terraform.tfvars` file is ignored by Git (see `.gitignore`) to help prevent accidental commits of sensitive data.

## FinOps - OpenInfraQuote
```bash
terraform plan -out=tf.plan
terraform show -json tf.plan > tfplan.json
```

## GOTCHA
```bash
terraform apply -target=module.org_admin.aws_iam_policy.org_admin_policy
```

These are taking lot of time, like 20 mins so far

"PermissionSetProvisioningStatus": 
        "Status": "IN_PROGRESS",
module.cloudtrail_logs.aws_s3_bucket.cloudtrail_bucket: Still creating... [01m20s elapsed]

sso:ProvisionPermissionSet is NOT covered by sso:*
SSO permission changes can take longer because AWS internally syncs the changes to identity services.


AWS has two distinct APIs:

sso:* → Old SSO login/session API.

sso-admin:* → Main API for managing Identity Center (permission sets, assignments, etc.).

But sso:ProvisionPermissionSet is NOT part of sso-admin:* or sso:*.
It’s a separate permission in the sso namespace.
So even if you write "sso-admin:*" it won’t include this.

 IAM Identity Center (AWS SSO) does not automatically send invite emails when users are created via Terraform or API.
 https://88hours.awsapps.com/start

 Terraform can’t directly retrieve the StartUrl. It can only reference instance_arn and identity_store_id via:
```bash
data "aws_ssoadmin_instances" "this" {}
```
It does not expose start_url.

Terraform (even run as admin) cannot push Docker images to ECR. You must build and push images manually or via CI/CD pipelines before ECS can pull them.


## TODO
- Passwords for the login profile are generated by AWS and can be encrypted with a PGP key if desired.
- Remove org-admin, just one IAM user as AWS Org admin to have billing notifications and do BAU activcities. 
- SSO user should have access keys
Use templatefile()
Move your JSON to policy.tpl.json and then 
```js
data "template_file" "policy" {
  template = file("${path.module}/policy.tpl.json")
  vars = {
    org_id = var.org_id
  }
}

resource "aws_iam_policy" "example" {
  name   = "example"
  policy = data.template_file.policy.rendered
}

```
